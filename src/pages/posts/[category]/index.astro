---
import BlogPostCard from "@components/BlogPostCard.astro";
import SimpleLayout from "@layouts/Simple.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const categories = await getCollection("blogCategories");
  const posts = await getCollection("blogPosts");

  return categories.map(({ id, data: category }) => ({
    params: { category: id },
    props: {
      category,
      entries: posts.filter((p) => p.data.categories.includes(id)),
    },
  }));
}

const { entries, category } = Astro.props;
---

<SimpleLayout title=`${category.name} | Blog | Trieve`>
  <section>
    <h1>Category: {category.name}</h1>
    <div class="grid grid-cols-1 sm:grid-cols-2! md:grid-cols-3! gap-4">
      {entries.map(async (e) => <BlogPostCard post={e} />)}
    </div>
  </section>
</SimpleLayout>
